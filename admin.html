<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LCA Admin Panel</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #FED100;
            --primary-dark: #E5BE00;
            --dark-color: #333333;
            --light-color: #FFFFFF;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Tajawal', sans-serif;
        }

        body {
            background-color: #f5f5f5;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 2rem;
        }

        .admin-container {
            background-color: white;
            padding: 2rem;
            border-radius: 15px;
            box-shadow: 0 0 30px rgba(0, 0, 0, 0.1);
            width: 95%;
            max-width: 1000px;
        }

        .login-form, .dashboard {
            display: none;
        }

        .active {
            display: block;
        }

        h1 {
            text-align: center;
            color: var(--dark-color);
            margin-bottom: 2rem;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        label {
            display: block;
            margin-bottom: 0.5rem;
            color: var(--dark-color);
        }

        input, textarea {
            width: 100%;
            padding: 0.8rem;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1rem;
        }

        textarea {
            min-height: 100px;
            resize: vertical;
        }

        button {
            width: 100%;
            padding: 1rem;
            background-color: var(--primary-color);
            color: var(--dark-color);
            border: none;
            border-radius: 5px;
            font-size: 1rem;
            cursor: pointer;
            transition: background-color 0.3s;
            margin-bottom: 1rem;
        }

        button:hover {
            background-color: var(--primary-dark);
        }

        .price-display {
            background-color: #f8f9fa;
            padding: 1rem;
            border-radius: 5px;
            margin-bottom: 1rem;
            text-align: center;
        }

        .price-display h2 {
            color: var(--dark-color);
            margin-bottom: 0.5rem;
        }

        .price-display p {
            font-size: 1.5rem;
            color: var(--primary-color);
            font-weight: bold;
        }

        .logout-btn {
            background-color: #dc3545;
            color: white;
        }

        .logout-btn:hover {
            background-color: #c82333;
        }

        .alert {
            padding: 1rem;
            border-radius: 5px;
            margin-bottom: 1rem;
            display: none;
        }

        .alert-success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .alert-danger {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .image-preview {
            max-width: 200px;
            margin: 1rem 0;
            border-radius: 5px;
            display: none;
        }

        .section {
            background-color: #f8f9fa;
            padding: 2rem;
            border-radius: 10px;
            margin-bottom: 2rem;
            border: 1px solid #eee;
            transition: all 0.3s ease;
        }

        .section:hover {
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        }

        .section h2 {
            color: var(--dark-color);
            margin-bottom: 1.5rem;
            font-size: 1.8rem;
            border-bottom: 2px solid var(--primary-color);
            padding-bottom: 0.5rem;
        }

        .language-tabs {
            display: flex;
            gap: 1rem;
            margin-bottom: 1.5rem;
            border-bottom: 1px solid #eee;
            padding-bottom: 1rem;
        }

        .language-tab {
            padding: 0.5rem 1rem;
            border: none;
            background: none;
            cursor: pointer;
            font-size: 1rem;
            color: var(--dark-color);
            border-radius: 5px;
            transition: all 0.3s ease;
        }

        .language-tab.active {
            background-color: var(--primary-color);
            color: var(--dark-color);
        }

        .language-content {
            display: none;
        }

        .language-content.active {
            display: block;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.8rem;
            color: var(--dark-color);
            font-weight: 500;
        }

        input, textarea {
            width: 100%;
            padding: 1rem;
            border: 2px solid #eee;
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        input:focus, textarea:focus {
            border-color: var(--primary-color);
            outline: none;
            box-shadow: 0 0 0 3px rgba(254, 209, 0, 0.1);
        }

        button {
            width: 100%;
            padding: 1rem;
            background-color: var(--primary-color);
            color: var(--dark-color);
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 1rem;
        }

        button:hover {
            background-color: var(--primary-dark);
            transform: translateY(-2px);
        }

        .image-preview {
            max-width: 300px;
            margin: 1rem 0;
            border-radius: 10px;
            display: none;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .price-display {
            background-color: #fff;
            padding: 1.5rem;
            border-radius: 10px;
            margin-bottom: 1.5rem;
            text-align: center;
            border: 2px solid var(--primary-color);
        }

        .price-display h2 {
            color: var(--dark-color);
            margin-bottom: 1rem;
            font-size: 1.5rem;
        }

        .price-display p {
            font-size: 2rem;
            color: var(--primary-color);
            font-weight: bold;
        }

        .maintenance-btn {
            background-color: #ffc107;
            color: #000;
        }

        .maintenance-btn:hover {
            background-color: #e0a800;
        }

        .maintenance-btn.active {
            background-color: #28a745;
            color: white;
        }

        .maintenance-btn.active:hover {
            background-color: #218838;
        }
    </style>
</head>
<body>
    <div class="admin-container">
        <!-- نموذج تسجيل الدخول -->
        <div class="login-form active">
            <h1>تسجيل الدخول</h1>
            <div class="alert alert-danger" id="loginError"></div>
            <div class="form-group">
                <label for="username">اسم المستخدم</label>
                <input type="text" id="username" required>
            </div>
            <div class="form-group">
                <label for="password">كلمة المرور</label>
                <input type="password" id="password" required>
            </div>
            <button onclick="login()">دخول</button>
        </div>

        <!-- لوحة التحكم -->
        <div class="dashboard">
            <h1>لوحة التحكم</h1>
            <div class="alert alert-success" id="successMessage"></div>

            <!-- قسم السعر -->
            <div class="section">
                <h2>إدارة السعر</h2>
                <div class="price-display">
                    <h2>السعر الحالي</h2>
                    <p id="currentPrice">$150</p>
                </div>
                <div class="form-group">
                    <label for="newPrice">تغيير السعر</label>
                    <input type="number" id="newPrice" placeholder="أدخل السعر الجديد">
                </div>
                <button onclick="updatePrice()">تحديث السعر</button>
            </div>

            <!-- قسم النصوص -->
            <div class="section">
                <h2>تحرير النصوص</h2>
                <div class="language-tabs">
                    <button class="language-tab active" onclick="switchLanguage('ar')">العربية</button>
                    <button class="language-tab" onclick="switchLanguage('en')">English</button>
                    <button class="language-tab" onclick="switchLanguage('tr')">Türkçe</button>
                </div>

                <!-- النصوص العربية -->
                <div class="language-content active" id="ar-content">
                    <div class="form-group">
                        <label for="ar-indicatorTitle">عنوان المؤشر</label>
                        <input type="text" id="ar-indicatorTitle" placeholder="مثال: موشر LCA">
                    </div>
                    <div class="form-group">
                        <label for="ar-features">المميزات (كل ميزة في سطر جديد)</label>
                        <textarea id="ar-features" placeholder="التداول مع مؤشرات LCA&#10;دليل استخدام مفصل&#10;فيديو تعليمي&#10;دعم فني"></textarea>
                    </div>
                </div>

                <!-- النصوص الإنجليزية -->
                <div class="language-content" id="en-content">
                    <div class="form-group">
                        <label for="en-indicatorTitle">Indicator Title</label>
                        <input type="text" id="en-indicatorTitle" placeholder="Example: LCA Indicator">
                    </div>
                    <div class="form-group">
                        <label for="en-features">Features (one per line)</label>
                        <textarea id="en-features" placeholder="Trading with LCA indicators&#10;Detailed user guide&#10;Tutorial video&#10;Technical support"></textarea>
                    </div>
                </div>

                <!-- النصوص التركية -->
                <div class="language-content" id="tr-content">
                    <div class="form-group">
                        <label for="tr-indicatorTitle">Gösterge Başlığı</label>
                        <input type="text" id="tr-indicatorTitle" placeholder="Örnek: LCA Göstergesi">
                    </div>
                    <div class="form-group">
                        <label for="tr-features">Özellikler (her satırda bir tane)</label>
                        <textarea id="tr-features" placeholder="LCA göstergeleri ile trading&#10;Detaylı kullanım kılavuzu&#10;Eğitim videosu&#10;Teknik destek"></textarea>
                    </div>
                </div>

                <button onclick="updateTexts()">تحديث النصوص</button>
            </div>

            <!-- قسم الصور -->
            <div class="section">
                <h2>رفع الصور</h2>
                <div class="form-group">
                    <label for="heroImage">صورة القسم الرئيسي</label>
                    <input type="file" id="heroImage" accept="image/*">
                    <img id="heroImagePreview" class="image-preview">
                </div>
                <div class="form-group">
                    <label for="featureImage">صورة المميزات</label>
                    <input type="file" id="featureImage" accept="image/*">
                    <img id="featureImagePreview" class="image-preview">
                </div>
                <button onclick="updateImages()">تحديث الصور</button>
            </div>

            <!-- قسم الصيانة -->
            <div class="section">
                <h2>وضع الصيانة</h2>
                <button id="maintenanceBtn" class="maintenance-btn" onclick="toggleMaintenance()">
                    تفعيل وضع الصيانة
                </button>
            </div>

            <button class="logout-btn" onclick="logout()">تسجيل الخروج</button>
        </div>
    </div>

    <script>
        // التحقق من توافق المتصفح
        function checkBrowserCompatibility() {
            if (!window.crypto || !window.crypto.subtle) {
                alert('عذراً، متصفحك لا يدعم الميزات المطلوبة. يرجى استخدام متصفح حديث مثل Chrome أو Firefox');
                return false;
            }
            return true;
        }

        // بيانات تسجيل الدخول (مشفرة)
        const ADMIN_CREDENTIALS = {
            username: 'admin',
            password: 'admin'
        };

        // إضافة حماية ضد محاولات تسجيل الدخول المتكررة
        let loginAttempts = 0;
        const MAX_LOGIN_ATTEMPTS = 5;
        let lockoutTime = 0;

        // دالة للتحقق من حالة القفل
        function checkLockout() {
            const now = Date.now();
            if (lockoutTime > now) {
                const remainingTime = Math.ceil((lockoutTime - now) / 1000);
                showError(`تم قفل الحساب مؤقتاً. يرجى المحاولة بعد ${remainingTime} ثواني`);
                return true;
            }
            if (lockoutTime !== 0) {
                loginAttempts = 0;
                lockoutTime = 0;
            }
            return false;
        }

        // تحميل البيانات المحفوظة
        function loadSavedData() {
            try {
                // تحميل النصوص العربية
                document.getElementById('ar-indicatorTitle').value = localStorage.getItem('ar-indicatorTitle') || 'موشر LCA';
                document.getElementById('ar-features').value = localStorage.getItem('ar-features') || 
                    'التداول مع مؤشرات LCA\nدليل استخدام مفصل\nفيديو تعليمي\nدعم فني';

                // تحميل النصوص الإنجليزية
                document.getElementById('en-indicatorTitle').value = localStorage.getItem('en-indicatorTitle') || 'LCA Indicator';
                document.getElementById('en-features').value = localStorage.getItem('en-features') || 
                    'Trading with LCA indicators\nDetailed user guide\nTutorial video\nTechnical support';

                // تحميل النصوص التركية
                document.getElementById('tr-indicatorTitle').value = localStorage.getItem('tr-indicatorTitle') || 'LCA Göstergesi';
                document.getElementById('tr-features').value = localStorage.getItem('tr-features') || 
                    'LCA göstergeleri ile trading\nDetaylı kullanım kılavuzu\nEğitim videosu\nTeknik destek';

                // تحميل حالة الصيانة
                const isMaintenance = localStorage.getItem('maintenanceMode') === 'true';
                updateMaintenanceButton(isMaintenance);

                // تحميل الصور
                const heroImage = localStorage.getItem('heroImage');
                const featureImage = localStorage.getItem('featureImage');
                if (heroImage) {
                    document.getElementById('heroImagePreview').src = heroImage;
                    document.getElementById('heroImagePreview').style.display = 'block';
                }
                if (featureImage) {
                    document.getElementById('featureImagePreview').src = featureImage;
                    document.getElementById('featureImagePreview').style.display = 'block';
                }
            } catch (error) {
                console.error('خطأ في تحميل البيانات:', error);
            }
        }

        // تحديث النصوص
        function updateTexts() {
            try {
                if (!validateSession()) return;

                // تنظيف وتخزين النصوص العربية
                const arTitle = sanitizeInput(document.getElementById('ar-indicatorTitle').value);
                const arFeatures = sanitizeInput(document.getElementById('ar-features').value);
                localStorage.setItem('ar-indicatorTitle', arTitle);
                localStorage.setItem('ar-features', arFeatures);

                // تنظيف وتخزين النصوص الإنجليزية
                const enTitle = sanitizeInput(document.getElementById('en-indicatorTitle').value);
                const enFeatures = sanitizeInput(document.getElementById('en-features').value);
                localStorage.setItem('en-indicatorTitle', enTitle);
                localStorage.setItem('en-features', enFeatures);

                // تنظيف وتخزين النصوص التركية
                const trTitle = sanitizeInput(document.getElementById('tr-indicatorTitle').value);
                const trFeatures = sanitizeInput(document.getElementById('tr-features').value);
                localStorage.setItem('tr-indicatorTitle', trTitle);
                localStorage.setItem('tr-features', trFeatures);

                showSuccess('تم تحديث النصوص بنجاح');
            } catch (error) {
                showError('حدث خطأ أثناء تحديث النصوص');
            }
        }

        // تحديث الصور
        function updateImages() {
            try {
                const heroImage = document.getElementById('heroImage').files[0];
                const featureImage = document.getElementById('featureImage').files[0];

                if (heroImage) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        localStorage.setItem('heroImage', e.target.result);
                        document.getElementById('heroImagePreview').src = e.target.result;
                        document.getElementById('heroImagePreview').style.display = 'block';
                    };
                    reader.readAsDataURL(heroImage);
                }

                if (featureImage) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        localStorage.setItem('featureImage', e.target.result);
                        document.getElementById('featureImagePreview').src = e.target.result;
                        document.getElementById('featureImagePreview').style.display = 'block';
                    };
                    reader.readAsDataURL(featureImage);
                }

                showSuccess('تم تحديث الصور بنجاح');
            } catch (error) {
                showError('حدث خطأ أثناء تحديث الصور');
            }
        }

        // تبديل وضع الصيانة
        function toggleMaintenance() {
            try {
                const isMaintenance = localStorage.getItem('maintenanceMode') === 'true';
                localStorage.setItem('maintenanceMode', !isMaintenance);
                updateMaintenanceButton(!isMaintenance);
                showSuccess(isMaintenance ? 'تم إيقاف وضع الصيانة' : 'تم تفعيل وضع الصيانة');
            } catch (error) {
                showError('حدث خطأ أثناء تغيير وضع الصيانة');
            }
        }

        // تحديث زر الصيانة
        function updateMaintenanceButton(isMaintenance) {
            const btn = document.getElementById('maintenanceBtn');
            btn.textContent = isMaintenance ? 'إيقاف وضع الصيانة' : 'تفعيل وضع الصيانة';
            btn.classList.toggle('active', isMaintenance);
        }

        // عرض رسالة نجاح
        function showSuccess(message) {
            const successMessage = document.getElementById('successMessage');
            successMessage.textContent = message;
            successMessage.className = 'alert alert-success';
            successMessage.style.display = 'block';
            setTimeout(() => {
                successMessage.style.display = 'none';
            }, 3000);
        }

        // عرض رسالة خطأ
        function showError(message) {
            const successMessage = document.getElementById('successMessage');
            successMessage.textContent = message;
            successMessage.className = 'alert alert-danger';
            successMessage.style.display = 'block';
            setTimeout(() => {
                successMessage.style.display = 'none';
            }, 3000);
        }

        // التحقق من حالة تسجيل الدخول
        function checkAuth() {
            try {
                const isLoggedIn = localStorage.getItem('isLoggedIn');
                if (isLoggedIn === 'true') {
                    showDashboard();
                }
            } catch (error) {
                console.error('خطأ في التحقق من تسجيل الدخول:', error);
            }
        }

        // تسجيل الدخول
        async function login() {
            if (!checkBrowserCompatibility()) return;

            if (checkLockout()) return;

            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            const loginError = document.getElementById('loginError');

            if (!username || !password) {
                loginError.style.display = 'block';
                loginError.textContent = 'يرجى إدخال اسم المستخدم وكلمة المرور';
                return;
            }

            try {
                if (username === ADMIN_CREDENTIALS.username && 
                    password === ADMIN_CREDENTIALS.password) {
                    localStorage.setItem('isLoggedIn', 'true');
                    // إضافة رمز جلسة فريد
                    const sessionToken = await generateSessionToken();
                    localStorage.setItem('sessionToken', sessionToken);
                    loginAttempts = 0;
                    showDashboard();
                } else {
                    loginAttempts++;
                    if (loginAttempts >= MAX_LOGIN_ATTEMPTS) {
                        lockoutTime = Date.now() + (30 * 1000); // قفل لمدة 30 ثانية
                        showError('تم قفل الحساب مؤقتاً بسبب محاولات تسجيل دخول متكررة');
                    } else {
                        loginError.style.display = 'block';
                        loginError.textContent = `اسم المستخدم أو كلمة المرور غير صحيحة. المحاولات المتبقية: ${MAX_LOGIN_ATTEMPTS - loginAttempts}`;
                    }
                }
            } catch (error) {
                console.error('خطأ في تسجيل الدخول:', error);
                loginError.style.display = 'block';
                loginError.textContent = 'حدث خطأ أثناء تسجيل الدخول';
            }
        }

        // توليد رمز جلسة فريد
        async function generateSessionToken() {
            const randomBytes = new Uint8Array(32);
            crypto.getRandomValues(randomBytes);
            return Array.from(randomBytes, byte => byte.toString(16).padStart(2, '0')).join('');
        }

        // التحقق من صلاحية الجلسة
        async function validateSession() {
            const sessionToken = localStorage.getItem('sessionToken');
            if (!sessionToken) {
                showLoginForm();
                return false;
            }
            return true;
        }

        // تحديث الدوال الحالية لتشمل التحقق من الجلسة
        function showDashboard() {
            if (!validateSession()) return;
            document.querySelector('.login-form').classList.remove('active');
            document.querySelector('.dashboard').classList.add('active');
            loadCurrentPrice();
            loadSavedData();
        }

        // تسجيل الخروج
        function logout() {
            localStorage.removeItem('isLoggedIn');
            localStorage.removeItem('sessionToken');
            showLoginForm();
        }

        // عرض نموذج تسجيل الدخول
        function showLoginForm() {
            document.querySelector('.dashboard').classList.remove('active');
            document.querySelector('.login-form').classList.add('active');
            document.getElementById('username').value = '';
            document.getElementById('password').value = '';
        }

        // تحميل السعر الحالي
        function loadCurrentPrice() {
            try {
                const currentPrice = localStorage.getItem('currentPrice') || '150';
                document.getElementById('currentPrice').textContent = `$${currentPrice}`;
            } catch (error) {
                console.error('خطأ في تحميل السعر:', error);
            }
        }

        // تحديث السعر
        function updatePrice() {
            try {
                const newPrice = document.getElementById('newPrice').value;
                const successMessage = document.getElementById('successMessage');

                if (!newPrice || isNaN(newPrice) || newPrice <= 0) {
                    showError('يرجى إدخال سعر صحيح');
                    return;
                }

                localStorage.setItem('currentPrice', newPrice);
                loadCurrentPrice();
                showSuccess('تم تحديث السعر بنجاح');
                document.getElementById('newPrice').value = '';
            } catch (error) {
                showError('حدث خطأ أثناء تحديث السعر');
            }
        }

        // تبديل اللغة في لوحة التحكم
        function switchLanguage(lang) {
            // تحديث الأزرار النشطة
            document.querySelectorAll('.language-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            event.target.classList.add('active');

            // تحديث المحتوى النشط
            document.querySelectorAll('.language-content').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById(`${lang}-content`).classList.add('active');
        }

        // إضافة حماية ضد XSS
        function sanitizeInput(input) {
            return input.replace(/[&<>"']/g, function(m) {
                const map = {
                    '&': '&amp;',
                    '<': '&lt;',
                    '>': '&gt;',
                    '"': '&quot;',
                    "'": '&#39;'
                };
                return map[m];
            });
        }

        // التحقق من حالة تسجيل الدخول عند تحميل الصفحة
        document.addEventListener('DOMContentLoaded', function() {
            checkBrowserCompatibility();
            checkAuth();
        });
    </script>
</body>
</html> 
